Djangodash: послесловие
=======================

:date: 2011-09-07
:slug: djangodash-afterword
:tags: django, djangodash, djangolint
:author: Dima Kukushkin

Так получилось, что об участии в Djangodash_ мы никому особо и не рассказывали.
Лично я, да и Миша с Наташей, думаю, расценивали этот конкурс, как веселое
времяпрепровождение, ну и силы попробовать, конечно, было интересно.

.. _Djangodash: http://djangodash.com

Команду планировалось назвать Losers, но что-то пошло не так, и получилось
Loosers :)))

Перед тем, как собраться в первый раз, каждый из нас должен был подумать насчет
идеи проекта. У меня ничего толкового не придумалось, а когда собрались, Наташа
предложила сервис, который позволяет найти неоптимальный и устаревший код в
Django приложениях и проектах. Так как больше ничего интересного в голову не
пришло, мы остановились на этой идее.

До участия в Djangodash мы решили потренироваться, как нам тогда казалось, на
простом проекте. Мы чуть-чуть порисовали, обсудили пару моментов и сели
"кодить". В процессе мы поняли, что сильно промахнулись, решив сесть за
реализацию, не обговорив все мелочи. В какой-то момент мы все бросили и сели
заново обсуждать. В итоге большую часть кода пришлось переписывать. Это был
очень полезный урок перед конкурсом: мы начали понимать, как надо распределять
задачи, и до какой степени нужно продумать работу сервиса, чтобы таких проблем
не возникло.

Перед конкурсом у нас была исписана куча стикеров с задачами, и каждый
предельно ясно представлял, в каком направлении он будет работать. Наташа была
ответственная за дизайн и верстку, за мной были задачи celery и деплой с
помощью chef и fabric на VDS. Мише предстояла самая сложная задача -
анализирование кода с помощью стандартной библиотеки AST.

Выспавшись, мы встали в 4 утра, и сели за реализацию, забирая себе стикеры с
задачами, над которыми собирались трудиться. Сразу договорились покрывать
максимальное количество кода тестами. Часть функционала сначала просто
прототипировали, постепенно заменяя прототипы реальным кодом.

За все время мы столкнулись с некоторыми сложностями, связанными с Celery и
AST:

1. Celery попросту не запускалась, причиной была несовместимость последних
   версий некоторых пакетов (помоему django-kombu и Celery, но я могу
   ошибаться). Также, задача, в которой происходило клонирование, раздувалась
   в памяти, видимо что-то вызывало утечки. Решили мы данную проблему
   достаточно быстро, настроив Celery таким образом, чтобы она перезапускала
   воркер после каждой отработанной задачи.
2. С AST проблемы начались после деплоя на виртуальную машину: некоторые
   результаты анализа кода получались не правильными, хотя локально мы этого не
   наблюдали. Заметив, что на виртуальной машине Python2.6, а на наших машинах
   2.7, мы приняли решение вместо Ubuntu 10.10 использовать для деплоя Ubuntu
   11.04.

Искать причины некоторых проблем во время конкурса мы не стали, потому что
анализ занял бы слишком много времени.

По поводу дедлайна: мы не почуствовали никакого дедлайна :). Мы спокойно
прерывались, в перерывах смотрели "Во все тяжкие" и ели мороженку :). С субботы
на воскресение выспались. Все запустить удалось уже около 11 вечера в
воскресение. Спокойно легли спать, а с утра пошли на работу.

В итоге, мы допустили одну очень обидную ошибку: при клонировании репозитория,
мы не проверяли ни язык репозитория, ни его размеры. Добрые люди не пренебрегли
поставить ядро Linux на проверку, что подвесило Celery. Практически сразу после
окончания конкурса мы исправили этот косяк и запустили еще одну версию сервиса
на djangolint.com_, где сейчас он и находится. Судьям были отправлены
уведомления о необходимости зайти на сервер и перезапустить Celery.

.. _djangolint.com: http://djangolint.com

Djangodash мне запомнился тем, что было весело. Ну и победой, конечно :D
